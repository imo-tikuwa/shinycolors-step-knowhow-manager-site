import{_ as P}from"./CommonHeader.2e5d7ed8.js";import{_ as V}from"./KnowhowBookInfoTableRow.85ed11af.js";import{u as $,d as M}from"./index.9359a4cc.js";import{a as A,b as N,e as O,f as R,h as g,r as j,i as q,A as x,j as k,s as c,k as t,w as d,E as G,c as u,m as y,l as h,o as l,D as L,p as B,q as D,t as E,B as z}from"./entry.27cf4ff3.js";import"./composables.7b9d3ec3.js";const U=N({setup(){const o=O(),f=$(),{$constants:C}=R(),b=g({displaySelectModal:!1}),m=g([]),v=j([]),p=g([]),w=g([]);q(()=>{m.splice(0,m.length,...M(f.unserializedData)),m.forEach((r,n)=>{r.id=n+1}),a()});const a=()=>{v.value=[],b.displaySelectModal=!0},_=()=>{b.displaySelectModal=!1},K=()=>{const r=m.filter(n=>v.value.includes(n.id));if(r.length!==3)return o.require({header:"選択エラー",message:"ノウハウブックは3冊選択してください",acceptLabel:"OK",acceptIcon:"pi pi-check",rejectClass:"hidden"}),!1;p.splice(0),r.forEach(n=>{p.push(M(n))}),w.splice(0),p.forEach(n=>{n.knowhows.forEach(i=>{i.knowhow&&i.level&&!w.find(e=>e.code===i.knowhow.code)&&w.push(i.knowhow)})}),w.sort((n,i)=>{const e=C.flattenKnowhowCodes.indexOf(n.code),s=C.flattenKnowhowCodes.indexOf(i.code);return e-s}),b.displaySelectModal=!1},I=(r,n)=>{let i=r.find(e=>{var s;return((s=e.knowhow)==null?void 0:s.code)===n.code});return i?i.level.name:null},S=r=>{let n=0;return p.forEach(i=>{i.knowhows.find(e=>{var s;return((s=e.knowhow)==null?void 0:s.code)===r.code})&&n++}),n};return{...x(b),knowhowBooks:m,bringInKnowhowBookIds:v,bringInKnowhowBooks:p,includesKnowhows:w,openSelectModal:a,closeSelectModal:_,closeSelectModalAndDisplayKnowhowBooks:K,displayKnowhow:I,displayKnowhowCount:S}}}),F={class:"container"},H={class:"flex flex-column mx-2"},J={key:0,class:"flex justify-content-center"},Q=c("span",{class:"p-column-title white-space-nowrap mr-3"},"ノウハウ",-1),W={class:"grid"},X={class:"col-12"},Y=c("h4",null,"STEPに持ち込むノウハウブックを3冊選択してください",-1),Z={class:"p-datatable p-component p-datatable-gridlines p-datatable-sm"},oo={class:"p-datatable-wrapper"},eo={class:"p-datatable-table"},no={class:"p-datatable-tbody"};function so(o,f,C,b,m,v){const p=h("Button"),w=P,a=h("Column"),_=h("Row"),K=h("ColumnGroup"),I=h("DataTable"),S=h("Checkbox"),r=V,n=h("Dialog"),i=z("tooltip");return l(),k(y,null,[c("div",F,[t(w,null,{"unique-functions":d(()=>[c("div",H,[L(t(p,{label:"ノウハウブックを3冊選択",icon:"pi pi-book",class:"p-button-sm white-space-nowrap w-full",iconPos:"right",onClick:o.openSelectModal},null,8,["onClick"]),[[i,{value:"STEPに持ち込むノウハウブック3冊を選択します",class:"custom-tooltip"},void 0,{bottom:!0}]])])]),_:1}),o.bringInKnowhowBooks.length<=0?(l(),k("div",J,[c("span",{style:G({color:"var(--red-500)"})}," ↑「ノウハウブックを3冊選択」ボタンよりSTEPに持ち込むノウハウブックを3冊選択してください ",4)])):(l(),u(I,{key:1,value:o.bringInKnowhowBooks,class:"p-datatable-sm mb-4",dataKey:"id",showGridlines:"",responsiveLayout:"scroll"},{default:d(()=>[t(K,{type:"header"},{default:d(()=>[t(_,null,{default:d(()=>[t(a,{header:"キャラクター",rowspan:2,field:"name.code",class:"white-space-nowrap",style:{width:"130px"}}),t(a,{colspan:o.includesKnowhows.length},{header:d(e=>[Q]),_:1},8,["colspan"])]),_:1}),t(_,null,{default:d(()=>[o.includesKnowhows.length?(l(!0),k(y,{key:0},B(o.includesKnowhows,e=>(l(),u(a,{field:e.code,header:e.name,key:e.code,class:"white-space-nowrap"},null,8,["field","header"]))),128)):(l(),u(a,{key:1}))]),_:1})]),_:1}),t(a,{field:"name",header:"キャラクター"},{body:d(e=>{var s;return[D(E((s=e.data.name)==null?void 0:s.name),1)]}),_:1}),o.includesKnowhows&&o.includesKnowhows.length?(l(!0),k(y,{key:0},B(o.includesKnowhows,(e,s)=>(l(),u(a,{field:"knowhow"+s,header:e.name,class:"text-center"},{body:d(T=>[D(E(o.displayKnowhow(T.data.knowhows,e)),1)]),_:2},1032,["field","header"]))),256)):(l(),u(a,{key:1})),t(K,{type:"footer"},{default:d(()=>[t(_,null,{default:d(()=>[t(a,{footer:"冊数"}),o.includesKnowhows&&o.includesKnowhows.length?(l(!0),k(y,{key:0},B(o.includesKnowhows,(e,s)=>(l(),u(a,{footer:o.displayKnowhowCount(e),class:"text-center"},null,8,["footer"]))),256)):(l(),u(a,{key:1}))]),_:1})]),_:1})]),_:1},8,["value"]))]),t(n,{header:"ノウハウブックを3冊選択",visible:o.displaySelectModal,"onUpdate:visible":f[1]||(f[1]=e=>o.displaySelectModal=e),breakpoints:{"1200px":"90vw","960px":"90vw","760px":"90vw"},style:{width:"65vw"},modal:!0},{footer:d(()=>[t(p,{label:"キャンセル",icon:"pi pi-times",class:"p-button-sm p-button-text",iconPos:"right",onClick:o.closeSelectModal},null,8,["onClick"]),t(p,{label:"OK",icon:"pi pi-check",class:"p-button-sm",iconPos:"right",onClick:o.closeSelectModalAndDisplayKnowhowBooks,autofocus:""},null,8,["onClick"])]),default:d(()=>[c("div",W,[c("div",X,[Y,c("div",Z,[c("div",oo,[c("table",eo,[c("tbody",no,[(l(!0),k(y,null,B(o.knowhowBooks,e=>(l(),u(r,{knowhowBook:e},{"first-row-append":d(()=>[t(S,{modelValue:o.bringInKnowhowBookIds,"onUpdate:modelValue":f[0]||(f[0]=s=>o.bringInKnowhowBookIds=s),value:e.id,disabled:o.bringInKnowhowBookIds.length>=3&&!o.bringInKnowhowBookIds.includes(e.id)},null,8,["modelValue","value","disabled"])]),_:2},1032,["knowhowBook"]))),256))])])])])])])]),_:1},8,["visible"])],64)}const ro=A(U,[["render",so]]);export{ro as default};
