import{d as j,E as q,G as k,Q as H,r as U,o as F,T as J,v as w,x as r,z as a,A as c,H as s,Y as Q,L as m,I as B,J as v,V as W,t as l,W as Y,K as x,B as E,y as M,M as X,m as Z}from"./entry.CT79BaoY.js";import{_ as ee}from"./CommonHeader.vue.mQtipPT0.js";import oe from"./column.esm.nQLwj8jI.js";import te from"./row.esm.-4aINpbN.js";import se from"./columngroup.esm.ZQMaZ8uK.js";import ne from"./datatable.esm.dPV4RH7R.js";import ae from"./checkbox.esm.lnTYaHbG.js";import{_ as le}from"./KnowhowBookInfoTableRow.vue.NIIVmfA1.js";import{u as ie,d as I}from"./index.Q8HJPhrW.js";import"./splitbutton.esm.xCRM84Ra.js";import"./index.esm.5XxNoCtb.js";import"./tieredmenu.esm.QO6-SNjm.js";import"./index.esm.x2T5YPZ5.js";import"./dropdown.esm.ddHorO3S.js";import"./virtualscroller.esm.DtqGYpPe.js";import"./inputswitch.esm._JBw7jVb.js";import"./tabpanel.esm.eZRX8N4X.js";import"./tabview.esm._C_pd3Vo.js";import"./index.esm.TKwmD25t.js";import"./index.esm.mbCRdSoA.js";import"./sidebar.esm.PCardDTn.js";import"./paginator.esm.uGrTMJNI.js";import"./index.esm.FCud3n0c.js";import"./inputnumber.esm.BMusDygd.js";import"./index.esm.ni8Qcrut.js";import"./index.esm.8Pxoppl_.js";import"./inputtext.esm.s8xnoFLb.js";import"./index.esm.rulKywc7.js";import"./index.esm.Ki4zcxd3.js";import"./index.esm.1r7rg1TX.js";const ce={class:"container"},re={class:"flex flex-column mx-2"},de={key:0,class:"flex justify-content-center"},pe=r("span",{class:"p-column-title white-space-nowrap mr-3"},"ノウハウ",-1),me={class:"grid"},ue={class:"col-12"},fe=r("h4",null,"STEPに持ち込むノウハウブックを3冊選択してください",-1),he={class:"p-datatable p-component p-datatable-gridlines p-datatable-sm"},_e={class:"p-datatable-wrapper"},we={class:"p-datatable-table"},be={class:"p-datatable-tbody"},We=j({__name:"step-bring-in-test",setup(ve){const $=q(),D=ie(),{$constants:S}=Z(),y=k({displaySelectModal:!1}),{displaySelectModal:g}=H(y),b=k([]),u=U([]),h=k([]),i=k([]);F(()=>{b.splice(0,b.length,...I(D.unserializedData)),b.forEach((p,o)=>{p.id=(o+1).toString()}),C()});const C=()=>{u.value=[],y.displaySelectModal=!0},P=()=>{y.displaySelectModal=!1},T=()=>{const p=b.filter(o=>u.value.includes(o.id));if(p.length!==3)return $.require({header:"選択エラー",message:"ノウハウブックは3冊選択してください",acceptLabel:"OK",acceptIcon:"pi pi-check",rejectClass:"hidden"}),!1;h.splice(0),p.forEach(o=>{h.push(I(o))}),i.splice(0),h.forEach(o=>{o.knowhows.forEach(n=>{n.knowhow&&n.level&&!i.find(d=>{var e;return d.code===((e=n.knowhow)==null?void 0:e.code)})&&i.push(n.knowhow)})}),i.sort((o,n)=>{const d=S.flattenKnowhowCodes.indexOf(o.code),e=S.flattenKnowhowCodes.indexOf(n.code);return d-e}),y.displaySelectModal=!1},V=(p,o)=>{var d;let n=p.find(e=>{var _;return((_=e.knowhow)==null?void 0:_.code)===o.code});return n?(d=n.level)==null?void 0:d.name:null},L=p=>{let o=0;return h.forEach(n=>{n.knowhows.find(d=>{var e;return((e=d.knowhow)==null?void 0:e.code)===p.code})&&o++}),o.toString()};return(p,o)=>{const n=X,d=ee,e=oe,_=te,K=se,N=ne,O=ae,R=le,z=W,A=J("tooltip");return l(),w(v,null,[r("div",ce,[a(d,null,{"unique-functions":c(()=>[r("div",re,[Y(a(n,{label:"ノウハウブックを3冊選択",icon:"pi pi-book",class:"p-button-sm white-space-nowrap w-full",iconPos:"right",onClick:C},null,512),[[A,{value:"STEPに持ち込むノウハウブック3冊を選択します",class:"custom-tooltip"},void 0,{bottom:!0}]])])]),_:1}),s(h).length<=0?(l(),w("div",de,[r("span",{style:Q({color:"var(--red-500)"})}," ↑「ノウハウブックを3冊選択」ボタンよりSTEPに持ち込むノウハウブックを3冊選択してください ",4)])):(l(),m(N,{key:1,value:s(h),class:"p-datatable-sm mb-4",dataKey:"id",showGridlines:"",responsiveLayout:"scroll"},{default:c(()=>[a(K,{type:"header"},{default:c(()=>[a(_,null,{default:c(()=>[a(e,{header:"キャラクター",rowspan:2,field:"name.code",class:"white-space-nowrap",style:{width:"130px"}}),a(e,{colspan:s(i).length},{header:c(t=>[pe]),_:1},8,["colspan"])]),_:1}),a(_,null,{default:c(()=>[s(i).length?(l(!0),w(v,{key:0},x(s(i),t=>(l(),m(e,{field:t.code,header:t.name,key:t.code,class:"white-space-nowrap"},null,8,["field","header"]))),128)):(l(),m(e,{key:1}))]),_:1})]),_:1}),a(e,{field:"name",header:"キャラクター"},{body:c(t=>{var f;return[E(M((f=t.data.name)==null?void 0:f.name),1)]}),_:1}),s(i)&&s(i).length?(l(!0),w(v,{key:0},x(s(i),(t,f)=>(l(),m(e,{field:"knowhow"+f,header:t.name,class:"text-center"},{body:c(G=>[E(M(V(G.data.knowhows,t)),1)]),_:2},1032,["field","header"]))),256)):(l(),m(e,{key:1})),a(K,{type:"footer"},{default:c(()=>[a(_,null,{default:c(()=>[a(e,{footer:"冊数"}),s(i)&&s(i).length?(l(!0),w(v,{key:0},x(s(i),(t,f)=>(l(),m(e,{footer:L(t),class:"text-center"},null,8,["footer"]))),256)):(l(),m(e,{key:1}))]),_:1})]),_:1})]),_:1},8,["value"]))]),a(z,{header:"ノウハウブックを3冊選択",visible:s(g),"onUpdate:visible":o[1]||(o[1]=t=>B(g)?g.value=t:null),breakpoints:{"1200px":"90vw","960px":"90vw","760px":"90vw"},style:{width:"65vw"},modal:!0},{footer:c(()=>[a(n,{label:"キャンセル",icon:"pi pi-times",class:"p-button-sm p-button-text",iconPos:"right",onClick:P}),a(n,{label:"OK",icon:"pi pi-check",class:"p-button-sm",iconPos:"right",onClick:T,autofocus:""})]),default:c(()=>[r("div",me,[r("div",ue,[fe,r("div",he,[r("div",_e,[r("table",we,[r("tbody",be,[(l(!0),w(v,null,x(s(b),t=>(l(),m(R,{knowhowBook:t},{"first-row-append":c(()=>[a(O,{modelValue:s(u),"onUpdate:modelValue":o[0]||(o[0]=f=>B(u)?u.value=f:null),value:t.id,disabled:s(u).length>=3&&!s(u).includes(t.id)},null,8,["modelValue","value","disabled"])]),_:2},1032,["knowhowBook"]))),256))])])])])])])]),_:1},8,["visible"])],64)}}});export{We as default};
